{"version":3,"sources":["components/googleAutocomplete.js","components/googlePlacesSearch.js"],"names":["dmx","Component","extends","initialData","placeId","address","phone","phone2","latitude","longitude","icon","name","priceLevel","rating","types","url","utcOffset","vicinity","website","attributes","map","type","String","default","country","strict-bounds","Boolean","move-map","render","node","BaseComponent","prototype","call","this","$node","value","props","disabled","defaultValue","set","target","document","getElementById","dmxComponent","autocomplete","google","maps","places","Autocomplete","strictBounds","split","bindTo","setComponentRestrictions","addListener","onchange","bind","update","setOptions","place","getPlace","place_id","formatted_address","formatted_phone_number","international_phone_number","geometry","location","lat","lng","price_level","utc_offset","viewport","fitBounds","setCenter","setZoom","setTimeout","dispatchEvent","results","hasMore","status","Number","radius","bind-bounds","keyword","open-now","show-on-map","methods","nearby","request","markers","forEach","marker","setMap","bounds","getBounds","getCenter","openNow","PlacesService","nearbySearch","onresults","search","query","textSearch","getMore","pagination","hasNextPage","nextPage","opening_hours","isOpen","image","size","Size","origin","Point","anchor","scaledSize","Marker","title","position","push","console","warn"],"mappings":"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","file":"../dmxGooglePlaces/dmxGooglePlaces.js","sourcesContent":["dmx.Component('google-autocomplete', {\r\n\r\n    extends: 'input',\r\n\r\n    initialData:{\r\n        placeId: null,\r\n        address: null,\r\n        phone: null,\r\n        phone2: null,\r\n        latitude: null,\r\n        longitude: null,\r\n        icon: null,\r\n        name: null,\r\n        priceLevel: null,\r\n        rating: null,\r\n        types: null,\r\n        url: null,\r\n        utcOffset: null, // in minutes\r\n        vicinity: null,\r\n        website: null\r\n    },\r\n\r\n    attributes: {\r\n        map: {\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        country: { // restrict to country (ISO 3166-1 Alpha-2 country code) (up to 5 max, separate with comma)\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        types: {\r\n            type: String,\r\n            default: null // geocode, address, establishment, (regions), (cities)\r\n        },\r\n\r\n        'strict-bounds': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'move-map': {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        dmx.BaseComponent.prototype.render.call(this, node);\r\n        this.$node.value = this.props.value;\r\n        this.$node.disabled = this.props.disabled;\r\n        this.$node.defaultValue = this.props.value;\r\n        this.set('value', this.props.value);\r\n        this.set('disabled', this.props.disabled);\r\n\r\n        this.target = document.getElementById(this.props.map);\r\n        this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n\r\n        this.autocomplete = new google.maps.places.Autocomplete(this.$node, {\r\n            strictBounds: this.props['strict-bounds'],\r\n            types: this.props.types ? this.props.types.split(/\\s*,\\s*/) : [],\r\n        });\r\n\r\n        if (this.map) {\r\n            this.autocomplete.bindTo('bounds', this.map);\r\n        }\r\n\r\n        if (this.props.country) {\r\n            this.autocomplete.setComponentRestrictions({country: this.props.country.split(/\\s*,\\s*/)});\r\n        }\r\n\r\n        this.autocomplete.addListener('place_changed', this.onchange.bind(this));\r\n    },\r\n\r\n    update: function(props) {\r\n        if (this.props.map && !this.map) {\r\n            this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n            this.autocomplete.bindTo('bounds', this.map);\r\n        }\r\n\r\n        if (props['strict-bounds'] != this.props['strict-bounds']) {\r\n            this.autocomplete.setOptions({ strictBounds: this.props['strict-bounds'] });\r\n        }\r\n\r\n        if (props.types != this.props.types) {\r\n            this.autocomplete.setOptions({ types: this.props.types });\r\n        }\r\n\r\n        if (props.country != this.props.country) {\r\n            this.autocomplete.setComponentRestrictions({country: this.props.country ? this.props.country.split(/\\s*,\\s*/) : []});\r\n        }\r\n\r\n        if (props.disabled != this.props.disabled) {\r\n            this.$node.disabled = this.props.disabled;\r\n        }\r\n    },\r\n\r\n    onchange: function() {\r\n        var place = this.autocomplete.getPlace();\r\n        if (!place.place_id) return;\r\n\r\n        this.set('value', this.$node.value);\r\n        this.set({\r\n            placeId: place.place_id,\r\n            address: place.formatted_address,\r\n            phone: place.formatted_phone_number,\r\n            phone2: place.international_phone_number,\r\n            latitude: place.geometry.location.lat(),\r\n            longitude: place.geometry.location.lng(),\r\n            icon: place.icon,\r\n            name: place.name,\r\n            priceLevel: place.price_level,\r\n            rating: place.rating,\r\n            types: place.types,\r\n            url: place.url,\r\n            utcOffset: place.utc_offset,\r\n            vicinity: place.vicinity,\r\n            website: place.website\r\n        });\r\n\r\n        if (this.props['move-map'] && this.map) {\r\n            if (place.geometry.viewport) {\r\n                this.map.fitBounds(place.geometry.viewport);\r\n            } else {\r\n                this.map.setCenter(place.geometry.location);\r\n                this.map.setZoom(17);\r\n            }\r\n        }\r\n\r\n        setTimeout(this.dispatchEvent.bind(this, 'updated'), 100);\r\n    }\r\n\r\n});\r\n","dmx.Component('google-places-search', {\r\n\r\n    initialData:{\r\n        results: [],\r\n        hasMore: false,\r\n        status: ''\r\n    },\r\n\r\n    attributes: {\r\n        map: {\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        latitude: {\r\n            type: Number,\r\n            default: null\r\n        },\r\n\r\n        longitude: {\r\n            type: Number,\r\n            default: null\r\n        },\r\n\r\n        radius: { // in meters\r\n            type: Number,\r\n            default: null\r\n        },\r\n\r\n        'bind-bounds': { // search inside map boundaries, ignores lat/lng/radius\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        keyword: { // A term to be matched against all available fields\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        'open-now': { // Restricts results to only those places that are open right now.\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        type: { // supported types see: https://developers.google.com/places/supported_types?authuser=0\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        'show-on-map': {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    methods: {\r\n        nearby: function(name) { // name is optional\r\n            var request = {};\r\n\r\n            this.markers.forEach(function(marker) {\r\n                // remove from map\r\n                marker.setMap(null);\r\n            });\r\n\r\n            this.markers = [];\r\n\r\n            if (this.props['bind-bounds']) {\r\n                request.bounds = this.map.getBounds();\r\n            } else if (this.props.latitude != null && this.props.longitude != null) {\r\n                request.location = { lat: this.props.latitude, lng: this.props.longitude };\r\n\r\n                if (this.props.radius) {\r\n                    request.radius = this.props.radius;\r\n                }\r\n            } else if (this.props.radius) {\r\n                request.location = this.map.getCenter();\r\n                request.radius = this.props.radius;\r\n            }\r\n\r\n            request.openNow = this.props['open-now'];\r\n\r\n            if (this.props.type) {\r\n                request.type = this.props.type;\r\n            }\r\n\r\n            if (name) {\r\n                request.name = name;\r\n            }\r\n\r\n            var service = new google.maps.places.PlacesService(this.map);\r\n            service.nearbySearch(request, this.onresults.bind(this));\r\n        },\r\n\r\n        search: function(query) {\r\n            var request = { query: query };\r\n\r\n            this.markers.forEach(function(marker) {\r\n                // remove from map\r\n                marker.setMap(null);\r\n            });\r\n\r\n            this.markers = [];\r\n\r\n            if (this.props['bind-bounds']) {\r\n                request.bounds = this.map.getBounds();\r\n            } else if (this.props.latitude != null && this.props.longitude != null) {\r\n                request.location = { lat: this.props.latitude, lng: this.props.longitude };\r\n\r\n                if (this.props.radius) {\r\n                    request.radius = this.props.radius;\r\n                }\r\n            } else if (this.props.radius) {\r\n                request.location = this.map.getCenter();\r\n                request.radius = this.props.radius;\r\n            }\r\n\r\n            request.openNow = this.props['open-now'];\r\n\r\n            if (this.props.type) {\r\n                request.type = this.props.type;\r\n            }\r\n\r\n            var service = new google.maps.places.PlacesService(this.map);\r\n            service.textSearch(request, this.onresults.bind(this));\r\n        },\r\n\r\n        getMore: function() {\r\n            if (this.pagination && this.pagination.hasNextPage) {\r\n                this.pagination.nextPage();\r\n            }\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.markers = [];\r\n        this.target = document.getElementById(this.props.map);\r\n        this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n    },\r\n\r\n    update: function(props) {\r\n        if (this.props.map && !this.map) {\r\n            this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n        }\r\n    },\r\n\r\n    onresults: function(results, status, pagination) {\r\n        this.set('status', status);\r\n        this.set('hasMore', !!(pagination && pagination.hasNextPage));\r\n\r\n        this.pagination = pagination;\r\n\r\n        if (status == 'OK') {\r\n            this.set('results', results.map(function(place) {\r\n                return {\r\n                    placeId: place.place_id,\r\n                    address: place.formatted_address,\r\n                    latitude: place.geometry.location.lat(),\r\n                    longitude: place.geometry.location.lng(),\r\n                    icon: place.icon,\r\n                    name: place.name,\r\n                    priceLevel: place.price_level,\r\n                    rating: place.rating,\r\n                    types: place.types,\r\n                    vicinity: place.vicinity,\r\n                    openNow: place.opening_hours && place.opening_hours.isOpen()\r\n                }\r\n            }));\r\n\r\n            if (this.props['show-on-map']) {\r\n                // create markers on map\r\n                results.forEach(function(place) {\r\n                    var image = {\r\n                        url: place.icon,\r\n                        size: new google.maps.Size(71, 71),\r\n                        origin: new google.maps.Point(0, 0),\r\n                        anchor: new google.maps.Point(17, 34),\r\n                        scaledSize: new google.maps.Size(25, 25)\r\n                    };\r\n\r\n                    var marker = new google.maps.Marker({\r\n                        map: this.map,\r\n                        icon: image,\r\n                        title: place.name,\r\n                        position: place.geometry.location\r\n                    });\r\n\r\n                    this.markers.push(marker);\r\n                }, this);\r\n            }\r\n        } else {\r\n            console.warn('nearbySearch failed.', status);\r\n        }\r\n    }\r\n\r\n});\r\n"]}